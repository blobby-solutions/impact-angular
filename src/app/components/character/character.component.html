<ng-template [ngIf]="!character">
  <moe-loading-image></moe-loading-image>
</ng-template>

<ng-template [ngIf]="!!character">
  <div class="character-header">
    <div class="character-header-content">
      <img
        class="character-element"
        src="{{ utilityService.getElementImage(character.Element) }}"
      />
      <div class="character-header-text">
        <h1 class="character-name">{{ character.Name }}</h1>
        <moe-rarity
          class="character-rarity"
          [value]="character.Rarity"
        ></moe-rarity>
      </div>
    </div>
  </div>

  <div class="character-overview">
    <div
      class="character-region"
      [ngStyle]="{
        'background-image':
          'url(' + utilityService.getRegionBannerUrl(character.Region) + ')'
      }"
    >
      <div class="character-images">
        <div
          class="character-icon"
          [ngStyle]="{
            'background-image': 'url(' + character.Icon + ')'
          }"
        ></div>
        <div
          class="character-quote"
          [ngStyle]="{
            'background-image': 'url(' + character.Quote + ')'
          }"
        ></div>
        <img
          class="character-tier"
          src="{{ utilityService.getTierImage(character.Tier) }}"
        />
      </div>
    </div>

    <div
      class="character-image"
      [ngStyle]="{
        'background-image': 'url(' + character.Image + ')'
      }"
    ></div>

    <div class="character-overview-text">
      <div class="character-attributes">
        <div class="character-attributes-section">
          <div class="character-title-label">Title</div>
          <div class="character-title-value">{{ character.Title }}</div>
          <div class="character-faction-label">Faction</div>
          <div class="character-faction-value">{{ character.Faction }}</div>
        </div>

        <div class="character-attributes-section">
          <div class="character-weapon-label">Weapon</div>
          <div class="character-weapon-value">{{ character.Weapon }}</div>
          <div class="character-birthday-label">Birthday</div>
          <div class="character-birthday-value">{{ character.Birthday }}</div>
        </div>
      </div>

      <p class="character-description">{{ character.Description }}</p>
    </div>
  </div>

  <div class="character-links">
    <div class="character-links-content">
      <a [routerLink]="['/characters/' + character.Id + '/overview']"
        >overview</a
      >
      <a [routerLink]="['/characters/' + character.Id + '/talents']">talents</a>
      <a [routerLink]="['/characters/' + character.Id + '/constellations']"
        >constellations</a
      >
    </div>
  </div>

  <div class="character-body">
    <div id="character-main-content-container" class="main-section-1">
      <div
        id="character-overview-container"
        class="flex-column"
        *ngIf="pageId === 'overview'"
      >
        <div
          class="
            character-role-container
            content-card
            flex-column
            background-gray-2
          "
          *ngFor="let role of character.Roles"
        >
          <div
            class="content-card-title flex-row {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <i
              *ngIf="character.CharacterOverview?.RecommendedRole === role.Name"
              class="fas fa-star"
            ></i>
            <h3>{{ role.Name }}</h3>
          </div>
          <div class="content-card-body">
            <div
              class="role-description"
              [innerHtml]="role.Notes"
              linkHandler
            ></div>
            <div class="overview-content flex-row flex-space-evenly">
              <div class="overview-content-list flex-column">
                <div
                  class="overview-content-list-title flex-row flex-center flex-center-items {{
                    utilityService.getElementBackground(character.Element)
                  }}"
                >
                  <h4>Weapons</h4>
                </div>
                <a
                  href="{{ 'https://impact.moe/weapons/' + weapon.Weapon.Id }}"
                  class="overview-content-list-item flex-row"
                  *ngFor="let weapon of role.Weapons"
                >
                  <div
                    class="
                      overview-content-list-item-rank
                      flex-row flex-center flex-center-items
                      background-off-white
                    "
                  >
                    <p>{{ weapon.Rank }}</p>
                  </div>
                  <div
                    class="
                      overview-content-list-item-content
                      flex-row flex-center flex-center-items
                      background-gray-1
                    "
                  >
                    <p>{{ weapon.Weapon.Name }}</p>
                  </div>
                </a>
              </div>

              <div class="overview-content-list flex-column">
                <div
                  class="overview-content-list-title flex-row flex-center flex-center-items {{
                    utilityService.getElementBackground(character.Element)
                  }}"
                >
                  <h4>Artifacts</h4>
                </div>
                <a
                  href="{{
                    'https://impact.moe/artifact-set/' + artifact.ArtifactSet.Id
                  }}"
                  class="overview-content-list-item flex-row"
                  *ngFor="let artifact of role.Artifacts; let i = index"
                  [style.margin-top]="
                    i > 0 && role.Artifacts[i - 1].Rank === artifact.Rank
                      ? '0.2em'
                      : '1em'
                  "
                >
                  <div
                    class="
                      overview-content-list-item-rank
                      flex-row flex-center flex-center-items
                      background-off-white
                    "
                  >
                    <p>{{ artifact.Rank }}</p>
                  </div>
                  <div
                    class="
                      overview-content-list-item-content
                      flex-row flex-center flex-center-items
                      background-gray-1
                    "
                  >
                    <p>
                      {{
                        artifact.ArtifactSet.Name +
                          ((i > 0 &&
                            role.Artifacts[i - 1].Rank === artifact.Rank) ||
                          (i + 1 < role.Artifacts.length &&
                            role.Artifacts[i + 1].Rank === artifact.Rank)
                            ? ' (2)'
                            : ' (4)')
                      }}
                    </p>
                  </div>
                </a>
              </div>

              <div class="overview-content-list flex-column">
                <div
                  class="overview-content-list-title flex-row flex-center flex-center-items {{
                    utilityService.getElementBackground(character.Element)
                  }}"
                >
                  <h4>Main Stats</h4>
                </div>
                <div
                  class="overview-content-list-item flex-row"
                  *ngFor="let mainStat of role.MainStats"
                >
                  <div
                    class="
                      overview-content-list-item-rank
                      flex-row flex-center flex-center-items
                      background-off-white
                    "
                  >
                    <img
                      src="{{
                        utilityService.getArtifactImage64(mainStat.ArtifactType)
                      }}"
                    />
                  </div>
                  <div
                    class="
                      overview-content-list-item-content
                      flex-row flex-center flex-center-items
                      background-gray-1
                    "
                  >
                    <p>{{ mainStat.Type }}</p>
                  </div>
                </div>
              </div>

              <div class="overview-content-list flex-column">
                <div
                  class="overview-content-list-title flex-row flex-center flex-center-items {{
                    utilityService.getElementBackground(character.Element)
                  }}"
                >
                  <h4>Sub Stats</h4>
                </div>
                <div
                  class="overview-content-list-item flex-row"
                  *ngFor="let subStat of role.SubStats"
                >
                  <div
                    class="
                      overview-content-list-item-rank
                      flex-row flex-center flex-center-items
                      background-off-white
                    "
                  >
                    <p>{{ subStat.Rank }}</p>
                  </div>
                  <div
                    class="
                      overview-content-list-item-content
                      flex-row flex-center flex-center-items
                      background-gray-1
                    "
                  >
                    <p>{{ subStat.Type }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <moe-loading-image
          *ngIf="character.Roles.length == 0"
        ></moe-loading-image>
      </div>

      <div
        id="character-talents-container"
        class="flex-column"
        *ngIf="pageId === 'talents'"
      >
        <div
          appContentCard
          class="content-card character-talent-container background-gray-2"
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ normalTalent?.Image }}" />
            <h4>{{ normalTalent?.Name }}</h4>
            <div
              class="
                talent-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>Normal</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="talent-description">
              <p>{{ normalTalent?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="content-card character-talent-container background-gray-2"
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ elementalSkillTalent?.Image }}" />
            <h4>{{ elementalSkillTalent?.Name }}</h4>
            <div
              class="
                talent-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>Elemental Skill</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="talent-description">
              <p>{{ elementalSkillTalent?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="content-card character-talent-container background-gray-2"
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ elementalBurstTalent?.Image }}" />
            <h4>{{ elementalBurstTalent?.Name }}</h4>
            <div
              class="
                talent-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>Elemental Burst</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="talent-description">
              <p>{{ elementalBurstTalent?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="content-card character-talent-container background-gray-2"
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ passiveOneTalent?.Image }}" />
            <h4>{{ passiveOneTalent?.Name }}</h4>
            <div
              class="
                talent-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>1st Ascension Passive</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="talent-description">
              <p>{{ passiveOneTalent?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="content-card character-talent-container background-gray-2"
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ passiveTwoTalent?.Image }}" />
            <h4>{{ passiveTwoTalent?.Name }}</h4>
            <div
              class="
                talent-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>4th Ascension Passive</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="talent-description">
              <p>{{ passiveTwoTalent?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="content-card character-talent-container background-gray-2"
          *ngIf="passiveThreeTalent"
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ passiveThreeTalent?.Image }}" />
            <h4>{{ passiveThreeTalent?.Name }}</h4>
            <div
              class="
                talent-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>Utility Passive</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="talent-description">
              <p>{{ passiveThreeTalent?.Description }}</p>
            </div>
          </div>
        </div>
      </div>

      <div
        id="character-constellations-container"
        class="flex-column"
        *ngIf="pageId === 'constellations'"
      >
        <div
          appContentCard
          class="
            content-card
            character-constellation-container
            background-gray-2
          "
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ constellationOne?.Image }}" />
            <h4>{{ constellationOne?.Name }}</h4>
            <div
              class="
                constellation-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>C1</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="constellation-description">
              <p>{{ constellationOne?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="
            content-card
            character-constellation-container
            background-gray-2
          "
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ constellationTwo?.Image }}" />
            <h4>{{ constellationTwo?.Name }}</h4>
            <div
              class="
                constellation-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>C2</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="constellation-description">
              <p>{{ constellationTwo?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="
            content-card
            character-constellation-container
            background-gray-2
          "
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ constellationThree?.Image }}" />
            <h4>{{ constellationThree?.Name }}</h4>
            <div
              class="
                constellation-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>C3</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="constellation-description">
              <p>{{ constellationThree?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="
            content-card
            character-constellation-container
            background-gray-2
          "
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ constellationFour?.Image }}" />
            <h4>{{ constellationFour?.Name }}</h4>
            <div
              class="
                constellation-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>C4</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="constellation-description">
              <p>{{ constellationFour?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="
            content-card
            character-constellation-container
            background-gray-2
          "
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ constellationFive?.Image }}" />
            <h4>{{ constellationFive?.Name }}</h4>
            <div
              class="
                constellation-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>C5</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="constellation-description">
              <p>{{ constellationFive?.Description }}</p>
            </div>
          </div>
        </div>

        <div
          appContentCard
          class="
            content-card
            character-constellation-container
            background-gray-2
          "
        >
          <div
            class="content-card-title {{
              utilityService.getElementBackground(character.Element)
            }}"
          >
            <img src="{{ constellationSix?.Image }}" />
            <h4>{{ constellationSix?.Name }}</h4>
            <div
              class="
                constellation-tag-container
                background-gray-2
                flex-column flex-center
              "
            >
              <p>C6</p>
            </div>
            <div
              class="
                content-card-expand-button
                hover-background-gray-1
                flex-row flex-center
              "
            >
              <i class="fas fa-caret-down"></i>
            </div>
          </div>
          <div class="content-card-body">
            <div class="constellation-description">
              <p>{{ constellationSix?.Description }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
